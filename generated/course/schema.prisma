generator client {
  provider = "prisma-client-js"
  output   = "../../../generated/course"
}

datasource db {
  provider = "postgresql"
  url      = env("COURSE_DATABASE_URL")
}

model Post {
  id          String    @id @default(uuid())
  title       String
  content     String
  excerpt     String?
  slug        String?   @unique
  published   Boolean   @default(false)
  authorId    String    @map("author_id")
  tags        String[]  @default([])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  publishedAt DateTime? @map("published_at")

  @@map("posts")
}

model PostEvent {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  eventType String   @map("event_type")
  authorId  String   @map("author_id")
  eventData Json?    @map("event_data")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("post_events")
}

model PostView {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  viewerId  String?  @map("viewer_id")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("post_views")
}

model HomeSlider {
  id        String   @id @default(uuid())
  image     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")
}

model Category {
  id            String        @id @default(uuid())
  name          String
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @default(now()) @map("updated_at")
  isDeleted     Boolean       @default(false)
  type          CategoryType
  contents      Content[]
  courses       Course[]
  subCategories SubCategory[]

  @@map("category")
}

model SubCategory {
  id         String   @id @default(uuid())
  name       String
  categoryId String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @default(now()) @map("updated_at")
  isDeleted  Boolean  @default(false)
  courses    Course[]
  category   Category @relation(fields: [categoryId], references: [id])

  @@map("sub_category")
}

model HomeCategory {
  id        String             @id @default(uuid())
  name      String
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @default(now()) @map("updated_at")
  isDeleted Boolean            @default(false)
  items     HomeCategoryItem[]

  @@map("home_category")
}

model HomeCategoryItem {
  id             String       @id @default(uuid())
  homeCategoryId String
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @default(now()) @map("updated_at")
  type           CourseType
  courseId       String       @db.Uuid
  isDeleted      Boolean      @default(false)
  course         Course       @relation(fields: [courseId], references: [id])
  homeCategory   HomeCategory @relation(fields: [homeCategoryId], references: [id])

  @@unique([homeCategoryId, courseId])
  @@map("home_category_item")
}

model Course {
  name             String
  image            String?
  enrolledCount    Int                @default(0)
  date             DateTime           @default(now())
  categoryId       String?
  subCategoryId    String?
  isDeleted        Boolean            @default(false)
  createdAt        DateTime           @default(now())
  description      String?
  duration         Int?
  parentCourseId   String?            @db.Uuid
  updatedAt        DateTime           @updatedAt
  videoCount       Int                @default(0)
  id               String             @id @default(uuid()) @map("id") @db.Uuid
  rating           Float              @default(0)
  previewImage     String?
  previewVideo     String?
  ratings          Rating[]
  users            UserOnCourse[]
  Category         Category?          @relation(fields: [categoryId], references: [id])
  parentCourse     Course?            @relation("CourseToParent", fields: [parentCourseId], references: [id])
  subCourses       Course[]           @relation("CourseToParent")
  SubCategory      SubCategory?       @relation(fields: [subCategoryId], references: [id])
  CourseSection    CourseSection[]
  HomeCategoryItem HomeCategoryItem[]
  reviews          Review[]

  @@map("course")
}

model UserOnCourse {
  id        String       @id @default(uuid()) @db.Uuid
  userId    String
  courseId  String       @db.Uuid
  status    CourseStatus @default(IN_PROGRESS)
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @default(now()) @map("updated_at")
  Course    Course       @relation(fields: [courseId], references: [id])
}

model CourseSection {
  id          String     @id @default(uuid())
  title       String
  description String?
  courseId    String     @map("course_id") @db.Uuid
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  activities  Activity[]
  course      Course     @relation(fields: [courseId], references: [id])

  @@map("course_section")
}

model Activity {
  id        String        @id @default(uuid())
  title     String
  type      ActivityType  @default(URL)
  content   String?
  videoUrl  String?       @map("video_url")
  duration  Int?
  order     Int           @default(0)
  sectionId String        @map("section_id")
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")
  section   CourseSection @relation(fields: [sectionId], references: [id])

  @@map("activity")
}

model Review {
  id        String   @id @default(uuid())
  courseId  String   @db.Uuid
  userId    String
  text      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  Course    Course   @relation(fields: [courseId], references: [id])

  @@map("review")
}

model Rating {
  id        String   @id @default(uuid())
  userId    String
  courseId  String   @db.Uuid
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id])
}

model Faq {
  id        String   @id @default(uuid())
  question  String
  answer    String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faq")
}

model ContentType {
  id          String    @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  contents    Content[]

  @@map("content_types")
}

model Content {
  id           String      @id @default(uuid())
  typeId       String      @map("type_id")
  title        String
  description  String?
  fileUrl      String?     @map("file_url")
  thumbnailUrl String?     @map("thumbnail_url")
  author       String?
  publishedAt  DateTime?   @map("published_at")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  categoryId   String?     @map("category_id")
  content      String?
  category     Category?   @relation(fields: [categoryId], references: [id])
  type         ContentType @relation(fields: [typeId], references: [id])

  @@map("contents")
}

enum CategoryType {
  NORMAL
  FEATURE
}

enum CourseType {
  NORMAL
  FEATURE
}

enum ActivityType {
  FILE
  H5P
  URL
  PAGE
}

enum CourseStatus {
  IN_PROGRESS
  DONE
}
