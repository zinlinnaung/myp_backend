generator client {
  provider = "prisma-client-js"
  output   = "../../../generated/course"
}

datasource db {
  provider = "postgresql"
  url      = env("COURSE_DATABASE_URL")
}

model Post {
  id          String    @id @default(uuid())
  title       String
  content     String
  excerpt     String?
  slug        String?   @unique
  published   Boolean   @default(false)
  authorId    String    @map("author_id")
  tags        String[]  @default([])
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  publishedAt DateTime? @map("published_at")

  @@map("posts")
}

model PostEvent {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  eventType String   @map("event_type")
  authorId  String   @map("author_id")
  eventData Json?    @map("event_data")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("post_events")
}

model PostView {
  id        String   @id @default(uuid())
  postId    String   @map("post_id")
  viewerId  String?  @map("viewer_id")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("post_views")
}

model HomeSlider {
  id           String   @id @default(uuid())
  image        String
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @default(now()) @map("updated_at")
  websiteImage String?
}

model Category {
  id            String        @id @default(uuid())
  name          String
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @default(now()) @map("updated_at")
  isDeleted     Boolean       @default(false)
  type          CategoryType
  image         String?
  contents      Content[]
  courses       Course[]
  course2       course2[]
  subCategories SubCategory[]

  @@map("category")
}

model SubCategory {
  id         String    @id @default(uuid())
  name       String
  categoryId String
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @default(now()) @map("updated_at")
  isDeleted  Boolean   @default(false)
  courses    Course[]
  course2    course2[]
  category   Category  @relation(fields: [categoryId], references: [id])

  @@map("sub_category")
}

model HomeCategory {
  id        String             @id @default(uuid())
  name      String
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @default(now()) @map("updated_at")
  isDeleted Boolean            @default(false)
  items     HomeCategoryItem[]

  @@map("home_category")
}

model HomeCategoryItem {
  id             String       @id @default(uuid())
  homeCategoryId String
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @default(now()) @map("updated_at")
  type           CourseType
  courseId       String       @db.Uuid
  isDeleted      Boolean      @default(false)
  course2Id      String?      @db.Uuid
  course2        course2?     @relation(fields: [course2Id], references: [id])
  course         Course       @relation(fields: [courseId], references: [id])
  homeCategory   HomeCategory @relation(fields: [homeCategoryId], references: [id])

  @@unique([homeCategoryId, courseId])
  @@map("home_category_item")
}

model Course {
  name             String
  image            String?
  enrolledCount    Int                @default(0)
  date             DateTime           @default(now())
  categoryId       String?
  subCategoryId    String?
  isDeleted        Boolean            @default(false)
  createdAt        DateTime           @default(now())
  description      String?
  duration         Int?
  parentCourseId   String?            @db.Uuid
  updatedAt        DateTime           @updatedAt
  videoCount       Int                @default(0)
  id               String             @id @default(uuid()) @map("id") @db.Uuid
  rating           Float              @default(0)
  previewImage     String?
  previewVideo     String?
  ratings          Rating[]
  users            UserOnCourse[]
  certificate      certificate[]
  Category         Category?          @relation(fields: [categoryId], references: [id])
  parentCourse     Course?            @relation("CourseToParent", fields: [parentCourseId], references: [id])
  subCourses       Course[]           @relation("CourseToParent")
  SubCategory      SubCategory?       @relation(fields: [subCategoryId], references: [id])
  CourseSection    CourseSection[]
  feedback         feedback[]
  HomeCategoryItem HomeCategoryItem[]
  reviews          Review[]

  @@map("course")
}

model UserOnCourse {
  id                  String       @id @default(uuid()) @db.Uuid
  userId              String
  courseId            String       @db.Uuid
  status              CourseStatus @default(IN_PROGRESS)
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @default(now()) @map("updated_at")
  certificate         String?
  completedPercentage Int          @default(0)
  course2Id           String?      @db.Uuid
  course2             course2?     @relation(fields: [course2Id], references: [id])
  Course              Course       @relation(fields: [courseId], references: [id])

  @@unique([userId, courseId])
}

model CourseSection {
  id            String          @id @default(uuid())
  title         String
  description   String?
  courseId      String          @map("course_id") @db.Uuid
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")
  order         Int?
  isDeleted     Boolean         @default(false)
  course2Id     String?         @db.Uuid
  activities    Activity[]
  course2       course2?        @relation(fields: [course2Id], references: [id])
  course        Course          @relation(fields: [courseId], references: [id])
  userOnSection userOnSection[]

  @@map("course_section")
}

model Activity {
  id             String           @id @default(uuid())
  title          String
  type           ActivityType     @default(PAGE)
  content        String?
  order          Int              @default(0)
  sectionId      String           @map("section_id")
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")
  description    String?
  isDeleted      Boolean          @default(false)
  section        CourseSection    @relation(fields: [sectionId], references: [id])
  userOnActivity userOnActivity[]

  @@map("activity")
}

model Review {
  id        String   @id @default(uuid())
  courseId  String   @db.Uuid
  userId    String
  text      String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  course2Id String?  @db.Uuid
  course2   course2? @relation(fields: [course2Id], references: [id])
  Course    Course   @relation(fields: [courseId], references: [id])

  @@map("review")
}

model Rating {
  id        String   @id @default(uuid())
  userId    String
  courseId  String   @db.Uuid
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course2Id String?  @db.Uuid
  course2   course2? @relation(fields: [course2Id], references: [id])
  course    Course   @relation(fields: [courseId], references: [id])
}

model Faq {
  id        String   @id @default(uuid())
  question  String
  answer    String
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("faq")
}

model ContentType {
  id          String    @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  contents    Content[]

  @@map("content_types")
}

model Content {
  id           String      @id @default(uuid())
  typeId       String      @map("type_id")
  title        String
  description  String?
  fileUrl      String?     @map("file_url")
  thumbnailUrl String?     @map("thumbnail_url")
  author       String?
  publishedAt  DateTime?   @map("published_at")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  categoryId   String?     @map("category_id")
  content      String?
  category     Category?   @relation(fields: [categoryId], references: [id])
  type         ContentType @relation(fields: [typeId], references: [id])

  @@map("contents")
}

model newAndEvents {
  id          String   @id
  title       String
  image       String
  description String
  date        String
  time        String
  isDeleted   Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime
  location    String?
}

model certificate {
  id         String   @id
  name       String
  created_at DateTime @default(now())
  updated_at DateTime
  courseId   String   @db.Uuid
  course2Id  String?  @db.Uuid
  course2    course2? @relation(fields: [course2Id], references: [id])
  course     Course   @relation(fields: [courseId], references: [id])
}

model feedback {
  id         String   @id
  text       String
  created_at DateTime @default(now())
  updated_at DateTime
  courseId   String   @db.Uuid
  course2Id  String?  @db.Uuid
  course2    course2? @relation(fields: [course2Id], references: [id])
  course     Course   @relation(fields: [courseId], references: [id])
}

model userOnActivity {
  id         String   @id
  userId     String
  time       String?
  created_at DateTime @default(now())
  updated_at DateTime
  activityId String
  activity   Activity @relation(fields: [activityId], references: [id])
}

model userOnSection {
  id             String        @id
  userId         String
  sectionId      String
  time           String?
  created_at     DateTime      @default(now())
  updated_at     DateTime
  course_section CourseSection @relation(fields: [sectionId], references: [id])

  @@unique([userId, sectionId])
}

model certificate_templates {
  id              String   @id
  name            String
  backgroundImage String?
  components      Json
  created_at      DateTime @default(now())
  updated_at      DateTime
}

model course2 {
  id                 String             @id @db.Uuid
  image              String?
  name               String
  description        String?
  duration           Int?
  videoCount         Int                @default(0)
  enrolledCount      Int                @default(0)
  isDeleted          Boolean            @default(false)
  rating             Float              @default(0)
  date               DateTime           @default(now())
  parentCourseId     String?            @db.Uuid
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  categoryId         String?
  subCategoryId      String?
  previewImage       String?
  previewVideo       String?
  Rating             Rating[]
  UserOnCourse       UserOnCourse[]
  certificate        certificate[]
  category           Category?          @relation(fields: [categoryId], references: [id])
  course2            course2?           @relation("course2Tocourse2", fields: [parentCourseId], references: [id])
  other_course2      course2[]          @relation("course2Tocourse2")
  sub_category       SubCategory?       @relation(fields: [subCategoryId], references: [id])
  course_section     CourseSection[]
  feedback           feedback[]
  home_category_item HomeCategoryItem[]
  review             Review[]
}

enum CategoryType {
  NORMAL
  FEATURE
  CATEGORY_ONLY
}

enum CourseType {
  NORMAL
  FEATURE
}

enum ActivityType {
  PDF_FILE
  VIDEO_FILE
  H5P
  WEB_URL
  YOUTUBE_LINK
  PAGE
}

enum CourseStatus {
  IN_PROGRESS
  DONE
}
